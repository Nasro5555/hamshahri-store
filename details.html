<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>تکمیل سفارش</title>
  <link rel="stylesheet" href="styles.css?v=1" />
</head>
<body>
  <div class="bg"></div>

  <main class="container">
    <section class="hero">
      <a class="backLink" href="index.html">خانه</a>

      <div class="heroText">
        <h1>تکمیل سفارش</h1>
        <p class="muted" id="desc">—</p>
      </div>

      <div style="margin-top:14px;">
        <div class="smallNote" style="font-weight:1100;">رسید انتخاب‌شده</div>
        <img id="preview" class="receiptPreview" alt="رسید">
      </div>

      <div style="margin-top:16px;">
        <label class="fieldLabel">نام داخل بازی پابجی</label>
        <input id="pubgName" class="fieldInput" type="text" placeholder="مثال: Nasro">

        <label class="fieldLabel">ایدی پابجی</label>
        <input id="pubgId" class="fieldInput" type="text" inputmode="numeric" placeholder="مثال: 1234567890">

        <button id="sendBtn" class="btnPrimaryWide" type="button">ارسال نهایی</button>

        <div class="smallNote" style="margin-top:12px;">
          اگر تا ۱۰ دقیقه یوسی ارسال نشد، به واتساپ پیام دهید.
        </div>
      </div>
    </section>
  </main>

<script>
  const params = new URLSearchParams(location.search);
  const game = params.get("game") || sessionStorage.getItem("order_game") || "";
  const pack = params.get("pack") || sessionStorage.getItem("order_pack") || "";
  const price = params.get("price") || sessionStorage.getItem("order_price") || "";
  const method = params.get("method") || sessionStorage.getItem("order_method") || "";

  const toFa = (s)=> String(s).replace(/[0-9]/g, d=>"۰۱۲۳۴۵۶۷۸۹"[d]);

  const methodText = method === "atoma" ? "مومو atoma" : method === "hawala" ? "ام حواله m Hawala" : "";
  const parts = [];
  if (price) parts.push(toFa(price) + " افغانی");
  if (pack) parts.push("بسته " + toFa(pack) + " یوسی");
  if (methodText) parts.push("روش: " + methodText);
  document.getElementById("desc").textContent = parts.join(" - ") || "—";

  const dataUrl = sessionStorage.getItem("receipt_dataurl");
  const preview = document.getElementById("preview");
  if (dataUrl) preview.src = dataUrl;
  else preview.style.display = "none";

  document.getElementById("sendBtn").addEventListener("click", () => {
    const pubgName = document.getElementById("pubgName").value.trim();
    const pubgId = document.getElementById("pubgId").value.trim();

    if (!pubgName || !pubgId) {
      alert("لطفاً نام داخل بازی و ایدی پابجی را کامل وارد کنید.");
      return;
    }
    if (!dataUrl) {
      alert("رسید موجود نیست. لطفاً برگردید و دوباره رسید را انتخاب کنید.");
      return;
    }

    alert("ثبت شد ✅ (مرحله بعدی: ارسال خودکار به تلگرام)");
  });
</script>
</body>
</html>
