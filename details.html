<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>اطلاعات سفارش</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="bg"></div>

  <div class="container">
    <div class="hero">
      <a class="backLink link" href="index.html">بازگشت به صفحه اصلی</a>

      <div class="heroText" style="margin-top:12px;">
        <h1 id="h1">تکمیل سفارش</h1>
        <p class="muted" id="desc">—</p>
      </div>

      <div class="receiptPreviewBox">
        <div class="receiptTitle">رسید انتخاب‌شده</div>
        <img id="preview" class="receiptPreview" alt="رسید" />
        <div id="noPreview" class="muted" style="font-weight:900; display:none;">
          رسید پیدا نشد. لطفاً دوباره برگردید و رسید را انتخاب کنید.
        </div>
      </div>

      <!-- PUBG ONLY -->
      <div id="pubgForm" class="formBox">
        <div class="formTitle">اطلاعات پابجی</div>

        <label class="fieldLabel">نام داخل بازی پابجی</label>
        <input id="pubgName" class="fieldInput" type="text" placeholder="مثال: Nasro" />

        <label class="fieldLabel">ایدی پابجی</label>
        <input id="pubgId" class="fieldInput" type="text" inputmode="numeric" placeholder="مثال: 1234567890" />

        <button id="sendBtn" class="btnPrimaryWide" type="button">
          ارسال نهایی
        </button>

        <div class="smallNote" style="margin-top:12px;">
          اگر تا ۱۰ دقیقه یوسی ارسال نشد، به واتساپ پیام دهید.
        </div>
      </div>

      <!-- For other games later -->
      <div id="otherGameNote" class="smallNote" style="display:none; margin-top:14px;">
        این فرم فعلاً برای پابجی آماده است. برای بازی‌های دیگر بعداً با یک ادیت ساده اضافه می‌کنیم.
      </div>

    </div>
  </div>

<script>
  const params = new URLSearchParams(location.search);
  const game = params.get("game") || sessionStorage.getItem("order_game") || "";
  const item = params.get("item") || sessionStorage.getItem("order_item") || "";
  const amount = params.get("amount") || sessionStorage.getItem("order_amount") || "";
  const method = params.get("method") || sessionStorage.getItem("order_method") || "";

  const desc = document.getElementById("desc");
  const methodText =
    method === "atoma" ? "مومو atoma" :
    method === "hawala" ? "ام حواله m Hawala" :
    (method || "");

  const parts = [];
  if (amount) parts.push(amount + " افغانی");
  if (item) parts.push("بسته " + item + " یوسی");
  if (methodText) parts.push("روش: " + methodText);
  desc.textContent = parts.length ? parts.join(" - ") : "—";

  // رسید از sessionStorage
  const dataUrl = sessionStorage.getItem("receipt_dataurl");
  const preview = document.getElementById("preview");
  const noPreview = document.getElementById("noPreview");

  if (dataUrl) {
    preview.src = dataUrl;
  } else {
    preview.style.display = "none";
    noPreview.style.display = "block";
  }

  // فقط پابجی
  const pubgForm = document.getElementById("pubgForm");
  const otherGameNote = document.getElementById("otherGameNote");

  if (game.toLowerCase() === "pubg") {
    pubgForm.style.display = "block";
    otherGameNote.style.display = "none";
  } else {
    pubgForm.style.display = "none";
    otherGameNote.style.display = "block";
  }

  // فعلاً فقط ثبت/تست (مرحله بعدی: ارسال به تلگرام)
  document.getElementById("sendBtn").addEventListener("click", () => {
    const pubgName = document.getElementById("pubgName").value.trim();
    const pubgId = document.getElementById("pubgId").value.trim();

    if (!pubgName || !pubgId) {
      alert("لطفاً نام داخل بازی و ایدی پابجی را کامل وارد کنید.");
      return;
    }
    if (!dataUrl) {
      alert("رسید موجود نیست. لطفاً برگردید و دوباره رسید را انتخاب کنید.");
      return;
    }

    // ذخیره برای مرحله بعد (وقتی ارسال به تلگرام را فعال کنیم)
    sessionStorage.setItem("final_pubg_name", pubgName);
   
