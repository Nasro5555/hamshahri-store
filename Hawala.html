<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>پرداخت - ام حواله m Hawala</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="bg"></div>

  <div class="container">
    <div class="hero">
      <a class="backLink link" href="pay.html">بازگشت</a>

      <div class="heroText" style="margin-top:12px;">
        <h1 id="title">ام حواله m Hawala</h1>
        <p class="muted" id="amountLine">—</p>
      </div>

      <div class="payInfoCard">
        <div class="payBigNumber" dir="ltr">0789880937</div>
        <div class="payName">نام: nasrullah qanbari</div>
      </div>

      <div class="smallNote" style="margin-top:12px;">
        به شماره بالا <b>ام‌حواله</b> را ارسال کنید و سپس رسید را از طریق دکمه پایین ارسال کنید.
      </div>

      <div class="receiptBox">
        <div class="receiptTitle">ارسال رسید</div>

        <label class="fileBtn">
          انتخاب رسید
          <input id="receipt" type="file" accept="image/*" />
        </label>

        <div id="fileHint" class="muted" style="font-weight:900; font-size:12px; margin-top:10px;">
          هنوز فایلی انتخاب نشده
        </div>

        <button id="goNext" class="btnPrimaryWide" disabled>
          ادامه
        </button>
      </div>
    </div>
  </div>

<script>
  const params = new URLSearchParams(location.search);
  const amount = params.get("amount");
  const item   = params.get("item");
  const game   = params.get("game");
  const method = "hawala";

  if (amount) {
    document.getElementById("amountLine").textContent =
      (item ? `برای بسته ${item} یوسی، ` : "") + `${amount} افغانی پرداخت کنید`;
  } else {
    document.getElementById("amountLine").textContent = "لطفاً مبلغ را پرداخت کنید";
  }

  function saveOrderMeta() {
    sessionStorage.setItem("order_amount", amount || "");
    sessionStorage.setItem("order_item", item || "");
    sessionStorage.setItem("order_game", game || "");
    sessionStorage.setItem("order_method", method);
  }

  const receiptInput = document.getElementById("receipt");
  const fileHint = document.getElementById("fileHint");
  const goNext = document.getElementById("goNext");

  receiptInput.addEventListener("change", async () => {
    const f = receiptInput.files?.[0];
    if (!f) return;

    fileHint.textContent = `انتخاب شد: ${f.name}`;
    goNext.disabled = true;

    const reader = new FileReader();
    reader.onload = () => {
      sessionStorage.setItem("receipt_dataurl", reader.result);
      sessionStorage.setItem("receipt_name", f.name);
      sessionStorage.setItem("receipt_type", f.type || "image/jpeg");
      saveOrderMeta();
      goNext.disabled = false;
    };
    reader.readAsDataURL(f);
  });

  goNext.addEventListener("click", () => {
    const q = new URLSearchParams();
    if (amount) q.set("amount", amount);
    if (item) q.set("item", item);
    if (game) q.set("game", game);
    q.set("method", method);

    location.href = "details.html?" + q.toString();
  });
</script>
</body>
</html>
