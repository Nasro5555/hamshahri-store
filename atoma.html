<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>مومو atoma | پرداخت</title>
  <link rel="stylesheet" href="styles.css?v=1" />
</head>
<body>
  <div class="bg"></div>

  <main class="container">
    <section class="hero">
      <a class="backLink" href="javascript:history.back()">بازگشت</a>

      <div class="heroText">
        <h1 id="amountLine">مومو atoma</h1>
        <p class="muted">به شماره زیر مومو ارسال کنید و سپس رسید را آپلود کنید</p>
      </div>

      <div class="payInfoCard">
        <div class="payBigNumber" dir="ltr">0775053147</div>
        <div class="payName">نام: Nasrullah qanbari</div>
      </div>

      <div style="margin-top:16px;">
        <label class="fileBtn">
          انتخاب رسید
          <input id="receipt" type="file" accept="image/*" />
        </label>
        <div id="fileHint" class="smallNote">هنوز فایلی انتخاب نشده</div>
        <button id="goNext" class="btnPrimaryWide" disabled>ادامه</button>
      </div>
    </section>
  </main>

<script>
  const params = new URLSearchParams(location.search);
  const game = params.get("game") || "";
  const pack = params.get("pack") || "";
  const price = params.get("price") || "";
  const toFa = (s)=> String(s).replace(/[0-9]/g, d=>"۰۱۲۳۴۵۶۷۸۹"[d]);

  if (price) document.getElementById("amountLine").textContent = `${toFa(price)} افغانی پرداخت کنید`;

  const receiptInput = document.getElementById("receipt");
  const fileHint = document.getElementById("fileHint");
  const goNext = document.getElementById("goNext");

  receiptInput.addEventListener("change", () => {
    const f = receiptInput.files?.[0];
    if (!f) return;
    fileHint.textContent = `انتخاب شد: ${f.name}`;

    const reader = new FileReader();
    reader.onload = () => {
      sessionStorage.setItem("receipt_dataurl", reader.result);
      sessionStorage.setItem("order_game", game);
      sessionStorage.setItem("order_pack", pack);
      sessionStorage.setItem("order_price", price);
      sessionStorage.setItem("order_method", "atoma");
      goNext.disabled = false;
    };
    reader.readAsDataURL(f);
  });

  goNext.addEventListener("click", () => {
    const q = new URLSearchParams();
    if (game) q.set("game", game);
    if (pack) q.set("pack", pack);
    if (price) q.set("price", price);
    q.set("method", "atoma");
    location.href = "details.html?" + q.toString();
  });
</script>
</body>
</html>
